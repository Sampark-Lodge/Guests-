<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Calendar | Sampark Lodge</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --gold:#d4af37;
  --gold-dark:#8c7020;
  --border:#e6d8a8;
  --booked:#fff3b0;
  --text:#1a1a1a;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:'Lato',sans-serif;
  background:#fff;
  padding:20px;
  display:flex;
  justify-content:center;
}

.frame{
  max-width:1100px;
  width:100%;
  border:2px solid var(--border);
  border-radius:14px;
  padding:24px;
}

h1{
  font-family:'Cinzel',serif;
  text-align:center;
  font-weight:900;
  letter-spacing:2px;
}

.sub{
  text-align:center;
  font-size:12px;
  letter-spacing:2px;
  margin-bottom:20px;
}

.controls{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-bottom:20px;
}

.controls button{
  padding:10px 16px;
  font-family:'Cinzel',serif;
  cursor:pointer;
  border:1px solid var(--gold);
  background:var(--gold);
  color:#fff;
  border-radius:6px;
}

.layout{
  display:grid;
  grid-template-columns: 1fr 320px;
  gap:20px;
}

.calendar{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:20px;
}

.month{
  border:1px solid var(--border);
  border-radius:10px;
  overflow:hidden;
}

.month h2{
  background:var(--gold);
  color:#fff;
  text-align:center;
  padding:6px;
  font-size:16px;
}

.days{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  font-size:12px;
  text-align:center;
}

.day{
  padding:14px 4px;
  border:1px solid #eee;
  cursor:pointer;
}

.day.booked{
  background:var(--booked);
  box-shadow:inset 0 0 0 2px var(--gold-dark);
}

.day.selected{
  outline:2px solid #333;
}

/* Side Panel */
.panel{
  border:1px solid var(--border);
  border-radius:10px;
  padding:16px;
}

.panel h3{
  font-family:'Cinzel',serif;
  margin-bottom:10px;
}

.panel small{
  display:block;
  margin-bottom:10px;
  color:#555;
}

.panel textarea{
  width:100%;
  height:80px;
  padding:8px;
  resize:none;
  margin-bottom:10px;
}

.panel button{
  width:100%;
  padding:10px;
  margin-bottom:8px;
  border:none;
  cursor:pointer;
  border-radius:6px;
  font-family:'Cinzel',serif;
}

.save{
  background:var(--gold);
  color:#fff;
}

.remove{
  background:#b71c1c;
  color:#fff;
}

.hidden{display:none}

</style>
</head>
<body>

<div class="frame">
  <h1>SAMPARK LODGE</h1>
  <div class="sub">ADMIN BOOKING CALENDAR</div>

  <div class="controls">
    <button onclick="year--,render()">◀ Year</button>
    <strong id="yearLabel"></strong>
    <button onclick="year++,render()">Year ▶</button>
  </div>

  <div class="layout">
    <div id="calendar" class="calendar"></div>

    <div id="panel" class="panel hidden">
      <h3 id="panelDate"></h3>
      <small id="panelStatus"></small>
      <textarea id="noteInput" placeholder="Add internal note (optional)"></textarea>
      <button id="saveBtn" class="save">Save Booking</button>
      <button id="removeBtn" class="remove">Remove Booking</button>
    </div>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzts3-BHw_-Vhm0S5j3P5s6ZtioILUQxp0kN_AFqe7yiAyPWFN69KTgESIMfOJYzPtU6w/exec";
const PASS = "admin";

let year = new Date().getFullYear();
let booked = {};
let selectedDate = null;

(function auth(){
  if(prompt("Admin Password") !== PASS){
    location.href="index.html";
  }
})();

async function load(){
  const r = await fetch(API);
  const d = await r.json();
  booked = {};
  d.forEach(x => booked[x.date] = x.note || "");
}

function selectDate(date){
  selectedDate = date;
  document.querySelectorAll('.day').forEach(d=>d.classList.remove('selected'));
  document.querySelector(`[data-date="${date}"]`).classList.add('selected');

  document.getElementById("panel").classList.remove("hidden");
  document.getElementById("panelDate").innerText = date;
  document.getElementById("panelStatus").innerText =
    booked[date] ? "Already Booked" : "Available";

  document.getElementById("noteInput").value = booked[date] || "";

  document.getElementById("saveBtn").onclick = saveBooking;
  document.getElementById("removeBtn").onclick = removeBooking;

  document.getElementById("removeBtn").style.display =
    booked[date] ? "block" : "none";
}

async function saveBooking(){
  const note = document.getElementById("noteInput").value;
  await fetch(API,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({date:selectedDate,note})
  });
  await load();
  render();
  selectDate(selectedDate);
}

async function removeBooking(){
  await fetch(API,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({date:selectedDate})
  });
  selectedDate=null;
  document.getElementById("panel").classList.add("hidden");
  await load();
  render();
}

function render(){
  document.getElementById("yearLabel").innerText = year;
  const root = document.getElementById("calendar");
  root.innerHTML = "";

  const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];

  months.forEach((m,i)=>{
    const box=document.createElement("div");
    box.className="month";
    box.innerHTML=`<h2>${m}</h2><div class="days"></div>`;
    const days=box.querySelector(".days");

    const first=new Date(year,i,1).getDay();
    const total=new Date(year,i+1,0).getDate();

    for(let k=0;k<first;k++) days.appendChild(document.createElement("div"));

    for(let d=1;d<=total;d++){
      const iso=`${year}-${String(i+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
      const el=document.createElement("div");
      el.className="day";
      el.dataset.date=iso;
      el.innerText=d;
      if(booked[iso]) el.classList.add("booked");
      el.onclick=()=>selectDate(iso);
      days.appendChild(el);
    }
    root.appendChild(box);
  });
}

(async()=>{await load();render();})();
</script>

</body>
</html>
