<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sampark Lodge | Admin Calendar</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

<style>
:root {
    --c-gold:#D4AF37;
    --c-gold-dim:#C5A028;
    --c-white:rgba(255,255,255,.96);
    --font-h:'Cinzel',serif;
    --font-b:'Lato',sans-serif;
    --shadow:0 4px 15px rgba(0,0,0,.1);
}

*{box-sizing:border-box;margin:0;padding:0}

body{
    font-family:var(--font-b);
    background:#f4f4f4 url("./assets/bg.png") center/cover fixed;
    min-height:100vh;
}

/* AUTH */
#auth-overlay{
    position:fixed;inset:0;
    background:#000;
    display:flex;
    justify-content:center;
    align-items:center;
    color:var(--c-gold);
    z-index:9999;
}

/* LAYOUT */
.container{
    max-width:1100px;
    margin:0 auto;
    padding:20px;
    display:none;
}

/* HEADER */
header{
    max-width:1100px;
    margin:0 auto 25px;
    background:var(--c-white);
    padding:20px;
    border-radius:8px;
    box-shadow:var(--shadow);
    border-bottom:3px solid var(--c-gold);
    position:relative;
}

header h1{
    font-family:var(--font-h);
    text-align:center;
}

.header-controls{
    display:flex;
    justify-content:center;
    margin-top:15px;
}

.year-nav{
    display:flex;
    gap:14px;
    font-family:var(--font-h);
    font-size:1.4rem;
}

.nav-btn{
    border:2px solid var(--c-gold);
    background:none;
    padding:2px 12px;
    cursor:pointer;
}

.sync-btn{
    position:absolute;
    right:20px;
    top:20px;
    border:1px solid #ccc;
    background:none;
    padding:4px 8px;
    font-size:.75rem;
    cursor:pointer;
}

/* CALENDAR */
.calendar-grid{
    display:grid;
    gap:20px;
    grid-template-columns:1fr;
}
@media(min-width:768px){
    .calendar-grid{grid-template-columns:1fr 1fr}
}

.month-card{
    background:var(--c-white);
    padding:15px;
    border-radius:8px;
    box-shadow:var(--shadow);
}

.month-title{
    text-align:center;
    font-family:var(--font-h);
    color:var(--c-gold-dim);
    margin-bottom:10px;
}

.days-grid{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:4px;
}

.weekday{
    text-align:center;
    font-size:.7rem;
    font-weight:bold;
}

.day-cell{
    aspect-ratio:1;
    border:1px solid #eee;
    border-radius:4px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    background:#fff;
}

.day-cell.booked{
    background:var(--c-gold);
    color:#fff;
}

.day-cell.empty{border:none;background:none;cursor:default}

.date-eng{font-weight:700}
.date-ben{font-size:.65rem}

/* MODAL */
#modal-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    justify-content:center;
    align-items:center;
}

.modal{
    background:#fff;
    padding:20px;
    border-radius:8px;
    width:90%;
    max-width:380px;
}

.modal textarea{width:100%;margin:10px 0}

/* LOADING */
#loading-indicator{
    text-align:center;
    font-size:.75rem;
    color:#888;
}
</style>
</head>

<body>

<div id="auth-overlay"><h2>ðŸ”’ Restricted Access</h2></div>

<div class="container" id="app">
<header>
    <button class="sync-btn" onclick="fetchBookings()">â†» Sync</button>
    <h1>Sampark Lodge</h1>
    <div class="header-controls">
        <div class="year-nav">
            <button class="nav-btn" onclick="changeYear(-1)">â€¹</button>
            <span id="year-display"></span>
            <button class="nav-btn" onclick="changeYear(1)">â€º</button>
        </div>
    </div>
    <div id="loading-indicator"></div>
</header>

<div class="calendar-grid" id="calendar"></div>
</div>

<div id="modal-overlay">
<div class="modal">
<h3 id="modal-title"></h3>
<textarea id="note"></textarea>
<button onclick="saveBooking()">Save</button>
<button onclick="closeModal()">Cancel</button>
</div>
</div>

<script>
/* ================= PANJIKA ================= */
function getBengaliPanjika(dateObj){
    const y=dateObj.getFullYear(),m=dateObj.getMonth(),d=dateObj.getDate();
    const months=[
        {n:"à¦ªà§Œà¦·",s:new Date(y-1,11,16)},
        {n:"à¦®à¦¾à¦˜",s:new Date(y,0,15)},
        {n:"à¦«à¦¾à¦²à§à¦—à§à¦¨",s:new Date(y,1,14)},
        {n:"à¦šà§ˆà¦¤à§à¦°",s:new Date(y,2,15)},
        {n:"à¦¬à§ˆà¦¶à¦¾à¦–",s:new Date(y,3,14)},
        {n:"à¦œà§à¦¯à§ˆà¦·à§à¦ ",s:new Date(y,4,15)},
        {n:"à¦†à¦·à¦¾à¦¢à¦¼",s:new Date(y,5,15)},
        {n:"à¦¶à§à¦°à¦¾à¦¬à¦£",s:new Date(y,6,16)},
        {n:"à¦­à¦¾à¦¦à§à¦°",s:new Date(y,7,16)},
        {n:"à¦†à¦¶à§à¦¬à¦¿à¦¨",s:new Date(y,8,16)},
        {n:"à¦•à¦¾à¦°à§à¦¤à¦¿à¦•",s:new Date(y,9,16)},
        {n:"à¦…à¦—à§à¦°à¦¹à¦¾à¦¯à¦¼à¦£",s:new Date(y,10,15)}
    ];
    let md="à¦ªà§Œà¦·",dd=d;
    for(let i=months.length-1;i>=0;i--){
        if(dateObj>=months[i].s){
            dd=Math.floor((dateObj-months[i].s)/86400000)+1;
            md=months[i].n;break;
        }
    }
    let by=y-593;
    if(m<3||(m===3&&d<14))by=y-594;
    const suf=dd===1?"à¦²à¦¾":dd<=3?"à¦°à¦¾":"à¦¶à§‡";
    return `${dd}${suf} ${md} ${by}`;
}

/* ================= APP ================= */
const API="https://script.google.com/macros/s/AKfycbzts3-BHw_-Vhm0S5j3P5s6ZtioILUQxp0kN_AFqe7yiAyPWFN69KTgESIMfOJYzPtU6w/exec";
let year=new Date().getFullYear();
let data={},selectedDate=null;

document.addEventListener("DOMContentLoaded",()=>{
    if(prompt("Admin Password")==="admin"){
        auth-overlay.style.display="none";
        app.style.display="block";
        render();
        fetchBookings();
    }
});

function changeYear(d){year+=d;render()}
function render(){
    year-display.textContent=year;
    calendar.innerHTML="";
    const months=["January","February","March","April","May","June","July","August","September","October","November","December"];
    for(let m=0;m<12;m++){
        const first=new Date(year,m,1).getDay();
        const days=new Date(year,m+1,0).getDate();
        let html=`<div class="month-card"><div class="month-title">${months[m]}</div><div class="days-grid">`;
        ["S","M","T","W","T","F","S"].forEach(w=>html+=`<div class="weekday">${w}</div>`);
        for(let i=0;i<first;i++)html+=`<div class="day-cell empty"></div>`;
        for(let d=1;d<=days;d++){
            const ds=`${year}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
            const cls=data[ds]?"day-cell booked":"day-cell";
            const pan=getBengaliPanjika(new Date(ds));
            html+=`<div class="${cls}" onclick="openModal('${ds}')">
            <div class="date-eng">${d}</div>
            <div class="date-ben">${pan}</div></div>`;
        }
        html+=`</div></div>`;
        calendar.innerHTML+=html;
    }
}

async function fetchBookings(){
    loading-indicator.textContent="Syncing...";
    const r=await fetch(API);
    const j=await r.json();
    data={};j.forEach(e=>data[e.date]=e.note||"");
    render();loading-indicator.textContent="";
}

function openModal(d){
    selectedDate=d;
    modal-title.innerHTML=new Date(d).toDateString()+"<br>"+getBengaliPanjika(new Date(d));
    note.value=data[d]||"";
    modal-overlay.style.display="flex";
}
function closeModal(){modal-overlay.style.display="none"}
async function saveBooking(){
    const fd=new URLSearchParams({date:selectedDate,note:note.value});
    await fetch(API,{method:"POST",mode:"no-cors",body:fd});
    closeModal();fetchBookings();
}
</script>
</body>
</html>